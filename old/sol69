primes 1 1000|perl -e 'while(<>){chomp;push@p,$_}$n=1000000;@ar=(0);$p=2;while($p*$p[@ar]<=$n){push@ar,scalar@ar;$p*=$p[$#ar]}while(1){$p=1;$p*=$p[$_]for(@ar);if($p>$n){for$s(1..$#ar-1){$ar[$_]++;$ar[$_]=$ar[$_-1]+1 for($s+1..$#ar);$p=1;$p*=$p[$_]for(@ar);last if$p<=$n}last if$p>$n;next}my$tot=calcphi($p,@ar);$ar[$#ar]++}sub calcphi{my($p,@ar)=@_;my$tot=$p;for(1..@ar){my$mult=(-1)**$_;$tot+=$mult*$p/$_ for(sumprods($_,@ar))}print"$p:$tot:".($p/$tot)."\n";return$tot}sub sumprods{my($n,@ar)=@_;my@idx;for(0..$n-1){$idx[$_]=$_}my@r;while(1){my$p=1;$p*=$p[$ar[$_]]for(@idx);push@r,$p;$idx[$#idx]++;if($idx[$#idx]>=@ar){my$l=$#idx-1;while($l>=0){$idx[$l]++;last if$idx[$l]<@ar-$#idx+$l;$l--}last if$l<0;for($l+1..$#idx){$idx[$_]=$idx[$_-1]+1}}}return@r}'
